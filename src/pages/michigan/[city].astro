---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Section from '../../components/Section.astro';
import Button from '../../components/Button.astro';
import ServiceCard from '../../components/ServiceCard.astro';
import CTA from '../../components/CTA.astro';
import Icon from '../../components/Icon.astro';
import { cities, getCityBySlug, type City } from '../../content/cities';

export function getStaticPaths() {
  return cities.map(city => ({
    params: { city: city.slug },
    props: { city },
  }));
}

interface Props {
  city: City;
}

const { city } = Astro.props;

// Rotate through diverse client images for city pages
const cityImages = [
  '/images/assets/laurel_tree_counseling_11_(1).webp',
  '/images/assets/laurel_tree_counseling_12_(1).webp',
  '/images/assets/laurel_tree_counseling_9_(1).webp',
  '/images/assets/laurel_tree_counseling_10_(1).webp',
  '/images/assets/laurel_tree_counseling_homepage_(1).webp',
];
const cityIndex = cities.findIndex(c => c.slug === city.slug);
const heroImage = cityImages[cityIndex % cityImages.length];

const services = [
  {
    title: 'Anxiety & Depression',
    description: 'Evidence-based treatment combining CBT, mindfulness, and holistic approaches.',
    icon: 'anxiety',
    href: '/services/anxiety-depression',
  },
  {
    title: 'Trauma & PTSD',
    description: 'Compassionate, trauma-informed care to help you heal.',
    icon: 'trauma',
    href: '/services/trauma',
  },
  {
    title: 'Life Transitions',
    description: 'Support through career changes, grief, retirement, and major life events.',
    icon: 'transitions',
    href: '/services/life-transitions',
  },
  {
    title: 'Relationship Challenges',
    description: 'Individual therapy for communication, boundaries, and healthier connections.',
    icon: 'relationships',
    href: '/services/relationship-challenges',
  },
  {
    title: 'Bariatric Surgery Support',
    description: 'Specialized counseling for before and after weight loss surgery.',
    icon: 'bariatric',
    href: '/services/bariatric-support',
  },
  {
    title: 'Nutrition Counseling',
    description: 'Weight-inclusive nutrition therapy with our registered dietitian.',
    icon: 'nutrition',
    href: '/services/nutrition',
  },
];

const insurances = [
  { name: 'Blue Cross Blue Shield', logo: '/images/Blue-Cross-Blue-Shield-Logo-removebg-preview.avif' },
  { name: 'Blue Care Network', logo: '/images/blue+care+network.avif' },
  { name: 'Aetna', logo: '/images/1_Heart_Aetna_logo_sm_rgb_violet.png' },
  { name: 'United Healthcare', logo: '/images/UnitedHealthcare_(logo).svg.png' },
  { name: 'Cigna', logo: '/images/cigna-dentist-astoria.png' },
  { name: 'Priority Health', logo: '/images/priority-health-logo.avif' },
];

const metaDescription = `Telehealth therapy for ${city.name}, Michigan. Licensed counselors and psychologists offering anxiety, depression, trauma, life transitions, relationship, and bariatric support. ${city.description}`;
---

<BaseLayout
  title={`Telehealth Therapy in ${city.name}, Michigan`}
  description={metaDescription}
  ogImage={heroImage}
>
  <!-- Schema.org LocalBusiness Markup -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "MedicalBusiness",
    "name": `Laurel Tree Counseling - ${city.name}`,
    "description": metaDescription,
    "url": `https://laureltreecounseling.com/michigan/${city.slug}`,
    "telephone": "586-244-8087",
    "email": "info@laureltreecounseling.com",
    "areaServed": {
      "@type": "City",
      "name": city.name,
      "containedInPlace": {
        "@type": "State",
        "name": "Michigan"
      }
    },
    "medicalSpecialty": [
      "Mental Health",
      "Psychology",
      "Nutrition"
    ],
    "availableService": [
      {
        "@type": "MedicalTherapy",
        "name": "Telehealth Counseling"
      }
    ]
  })} slot="head" />

  <!-- Hero -->
  <section class="relative bg-gradient-to-br from-primary to-primary-dark overflow-hidden">
    <div class="absolute inset-0">
      <img
        src={heroImage}
        alt={`Virtual telehealth counseling services for ${city.name}, Michigan residents`}
        width="1920"
        height="1080"
        class="w-full h-full object-cover"
        loading="eager"
      />
      <div class="absolute inset-0 bg-gradient-to-r from-primary/90 to-primary-dark/85"></div>
    </div>
    <div class="container-custom relative z-10 py-16 md:py-20 text-center">
      <div class="max-w-3xl mx-auto">
        <p class="text-gold font-medium mb-2 tracking-wide uppercase text-sm">
          {city.region}
        </p>
        <h1 class="text-4xl md:text-5xl font-heading font-bold text-white mb-6">
          Telehealth Therapy in {city.name}, Michigan
        </h1>
        <p class="text-base md:text-lg text-white/90 leading-relaxed mb-8">
          {city.description} Our licensed counselors, psychologists, and dietitians provide comprehensive virtual care for anxiety, depression, trauma, and more.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <Button href="https://laureltreecounselingllc.clientsecure.me" variant="secondary" size="lg" external>
            Schedule a Session
          </Button>
          <a
            href="/contact"
            class="inline-flex items-center justify-center font-body font-semibold rounded-md px-8 py-4 text-lg min-h-[56px] border-2 border-white text-white bg-transparent hover:bg-white hover:text-primary transition-all duration-fast ease-out-expo hover:-translate-y-0.5 active:translate-y-0 focus-visible:ring-2 focus-visible:ring-white focus-visible:ring-offset-2"
          >
            Free Consultation
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Why Telehealth -->
  <Section>
    <div class="grid lg:grid-cols-5 gap-12 lg:gap-16 items-start">
      <div class="lg:col-span-2">
        <div class="accent-line">
          <h2 class="text-3xl font-heading font-bold text-text-primary mb-4">
            Quality Therapy from the Comfort of Home
          </h2>
        </div>
        <p class="subtitle">
          {city.name} residents can now access expert mental health care without leaving home. Our secure telehealth platform brings licensed professionals directly to you.
        </p>
      </div>

      <div class="lg:col-span-3 space-y-6 stagger-children">
        <div class="flex gap-4 fade-in fade-in-delay-1">
          <div class="icon-container-gold">
            <Icon name="Home" size={28} class="text-gold-dark" />
          </div>
          <div>
            <h3 class="text-xl font-bold text-text-primary mb-2">No Commute</h3>
            <p class="text-text-secondary">Save time and attend sessions from anywhere in {city.name}.</p>
          </div>
        </div>

        <div class="flex gap-4 fade-in fade-in-delay-2">
          <div class="icon-container-gold">
            <Icon name="Lock" size={28} class="text-gold-dark" />
          </div>
          <div>
            <h3 class="text-xl font-bold text-text-primary mb-2">HIPAA Secure</h3>
            <p class="text-text-secondary">Your sessions are private and protected.</p>
          </div>
        </div>

        <div class="flex gap-4 fade-in fade-in-delay-3">
          <div class="icon-container-gold">
            <Icon name="Clock" size={28} class="text-gold-dark" />
          </div>
          <div>
            <h3 class="text-xl font-bold text-text-primary mb-2">Flexible Scheduling</h3>
            <p class="text-text-secondary">Evening and weekend appointments available.</p>
          </div>
        </div>
      </div>
    </div>
  </Section>

  <!-- Services -->
  <Section background="surface">
    <div class="grid lg:grid-cols-5 gap-12 lg:gap-16 items-start">
      <!-- Left column: heading, button, and images (desktop only for images) -->
      <div class="lg:col-span-2 order-1">
        <div class="accent-line">
          <h2 class="text-3xl font-heading font-bold text-text-primary mb-4">
            Services Available in {city.name}
          </h2>
        </div>
        <p class="subtitle mb-6">
          Our team offers comprehensive mental health and nutrition services to {city.name} residents.
        </p>
        <Button href="/services" variant="secondary">
          View All Services
        </Button>

        <!-- Fill negative space with supportive images (desktop only) -->
        <div class="hidden lg:block mt-8 space-y-4">
          <img
            src="/images/assets/laurel_tree_counseling_11_(1).webp"
            alt="Professional counseling care"
            class="rounded-xl shadow-soft w-full object-cover"
            loading="lazy"
          />
          <img
            src="/images/assets/laurel_tree_counseling_17.webp"
            alt="Supportive telehealth counseling session"
            class="rounded-xl shadow-soft w-full object-cover"
            loading="lazy"
          />
          <img
            src="/images/assets/laurel_tree_counseling_9_(1).webp"
            alt="Holistic mental health support"
            class="rounded-xl shadow-soft w-full object-cover"
            loading="lazy"
          />
        </div>
      </div>

      <!-- Right column: service cards -->
      <div class="lg:col-span-3 grid sm:grid-cols-2 gap-4 stagger-children order-2">
        {services.map((service, index) => (
          <div class={`fade-in fade-in-delay-${Math.min(index + 1, 4)}`}>
            <ServiceCard {...service} />
          </div>
        ))}
      </div>
    </div>
  </Section>

  <!-- Insurance -->
  <Section>
    <div class="text-center mb-10">
      <div class="accent-line-center">
        <h2 class="text-2xl font-heading font-bold text-text-primary mb-4">
          Insurance Accepted for {city.name} Residents
        </h2>
      </div>
      <p class="subtitle max-w-2xl mx-auto">
        We also offer out-of-network and private pay options.
      </p>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-4 mb-8">
      {insurances.map((insurance) => (
        <div class="bg-background-surface border border-border rounded-lg p-4 flex items-center justify-center h-20">
          <img
            src={insurance.logo}
            alt={insurance.name}
            class="max-h-12 max-w-full object-contain"
            loading="lazy"
          />
        </div>
      ))}
    </div>

    <div class="text-center">
      <Button href="/insurance" variant="secondary">
        View Insurance Details
      </Button>
    </div>
  </Section>

  <!-- Team Preview -->
  <Section background="surface">
    <div class="text-center mb-8">
      <div class="accent-line-center">
        <h2 class="text-2xl font-heading font-bold text-text-primary mb-4">
          Meet Your {city.name} Care Team
        </h2>
      </div>
      <p class="subtitle max-w-2xl mx-auto">
        Our licensed professionals are ready to support your wellness journey.
      </p>
    </div>

    <!-- Mobile: Horizontal cards / Desktop: Grid -->
    <div class="space-y-4 md:hidden">
      <a href="/team" class="flex items-center gap-4 bg-background-surface border border-border rounded-xl p-4 hover:border-primary transition-colors">
        <img src="/images/kristen-ross.png" alt="Kristen Ross, LPC" class="w-16 h-16 rounded-full object-cover flex-shrink-0" loading="lazy" />
        <div>
          <h3 class="font-semibold text-text-primary">Kristen Ross, LPC</h3>
          <p class="text-primary text-sm">Lead Counselor</p>
        </div>
      </a>
      <a href="/team" class="flex items-center gap-4 bg-background-surface border border-border rounded-xl p-4 hover:border-primary transition-colors">
        <img src="/images/michele-meyers.png" alt="Michele Meyers, PsyD" class="w-16 h-16 rounded-full object-cover flex-shrink-0" loading="lazy" />
        <div>
          <h3 class="font-semibold text-text-primary">Michele Meyers, PsyD</h3>
          <p class="text-primary text-sm">Psychologist</p>
        </div>
      </a>
      <a href="/team" class="flex items-center gap-4 bg-background-surface border border-border rounded-xl p-4 hover:border-primary transition-colors">
        <img src="/images/meghan-pendleton.png" alt="Meghan Pendleton, RD" class="w-16 h-16 rounded-full object-cover flex-shrink-0" loading="lazy" />
        <div>
          <h3 class="font-semibold text-text-primary">Meghan Pendleton, RD</h3>
          <p class="text-primary text-sm">Dietitian</p>
        </div>
      </a>
    </div>

    <!-- Desktop: Card grid -->
    <div class="hidden md:grid md:grid-cols-3 gap-6">
      <a href="/team" class="text-center bg-background-surface border border-border rounded-xl p-6 hover:border-primary hover:shadow-md transition-all">
        <img src="/images/kristen-ross.png" alt="Kristen Ross, LPC" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover" loading="lazy" />
        <h3 class="text-lg font-semibold text-text-primary">Kristen Ross, LPC</h3>
        <p class="text-primary text-sm">Lead Counselor</p>
      </a>
      <a href="/team" class="text-center bg-background-surface border border-border rounded-xl p-6 hover:border-primary hover:shadow-md transition-all">
        <img src="/images/michele-meyers.png" alt="Michele Meyers, PsyD" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover" loading="lazy" />
        <h3 class="text-lg font-semibold text-text-primary">Michele Meyers, PsyD</h3>
        <p class="text-primary text-sm">Psychologist</p>
      </a>
      <a href="/team" class="text-center bg-background-surface border border-border rounded-xl p-6 hover:border-primary hover:shadow-md transition-all">
        <img src="/images/meghan-pendleton.png" alt="Meghan Pendleton, RD" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover" loading="lazy" />
        <h3 class="text-lg font-semibold text-text-primary">Meghan Pendleton, RD</h3>
        <p class="text-primary text-sm">Dietitian</p>
      </a>
    </div>

    <div class="text-center mt-8">
      <Button href="/team" variant="secondary">
        Read Full Bios
      </Button>
    </div>
  </Section>

  <!-- CTA -->
  <CTA
    title={`Ready to Start Therapy in ${city.name}?`}
    description="Schedule a free 15-minute consultation to discuss your needs and learn how we can support your wellness journey."
  />
</BaseLayout>
